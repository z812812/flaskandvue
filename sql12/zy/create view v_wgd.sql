--select * from v_wgd where 单据日期<='2018-04-25'
--as 员工代号
--SELECT * FROM v_wgd WHERE ygdh='13720'
alter view v_wgd 
as 
SELECT top 200000 s.DocCode as wgdh,s.DocDate as djrq,s.DocTime as djsj,p.DocCode as lzkh,o.MoCode as scdd,d.SortSeq as hh,  i.InvCode AS wlbm, i.InvAddCode AS wldh,i.InvName AS wlmc,i.InvStd AS wlgg,i.ComUnitName as jldw,d.Qty as scsl, mom_morder.StartDate as kgrq,  mom_morder.DueDate as wgrq, md.cDepCode as scbm,md.cDepName as bmmc,p.Qty as lzksl, pd.OpSeq as gxhh, sfc_operation.OpCode as bzgx, pd.Description AS gxsm,sfc_workcenter.WcCode AS gzzx,sfc_workcenter.Description AS gzzxmc,pd.StartDate as gxkgrq,pd.StartTime as gxkgsj,pd.DueDate as gxwgrq,pd.DueTime as gxwgsj, sd.EmployCode as ygdh,Person.cPersonName as ygxm, sd.QualifiedQty as hgsl, sd.ScrapQty as bfsl,sd.ScrapReasonCode as bfyy,sr.cReasonName as bfyysm,  d.MoLotCode AS scph   from sfc_pfreport  s  with (nolock) inner join sfc_pfreportdetail   sd with (nolock) on s.PFReportId = sd.PFReportId inner join sfc_processflow   p with (nolock) on s.PFId = p.PFId inner join sfc_processflowdetail   pd with (nolock) on sd.PFDId = pd.PFDId  inner join mom_orderdetail   d with (nolock) on d.MoDId = p.MoDId inner join mom_order   o with (nolock) on d.MoId = o.MoId inner join sfc_workcenter  with (nolock)  on pd.WcId =sfc_workcenter.WcId inner join v_bas_inventory   as i with (nolock) on i.InvCode = d.InvCode left outer join ComputationUnit   as fz with (nolock) on d.AuxUnitCode = fz.cComunitCode left outer join mom_morder  with (nolock)  on mom_morder.MoDId= d.MoDId  left outer join Department   as md with (nolock) on md.cDepCode = d.MDeptCode left outer join SO_SOMain   as sm with (nolock)  on d.SoType in (1,5) and d.SoCode = sm.cSOCode left outer join ex_order   as em with (nolock)  on d.SoType in (3,6) and d.SoCode = em.cCode LEFT OUTER JOIN Customer   as cm with (nolock) ON cm.cCusCode= coalesce(sm.cCusCode,em.cCusCode) left outer join mom_motype   as mt with (nolock)  on mt.MoTypeId = d.MoTypeId left outer join Reason   as mr with (nolock)  on mr.cReasonCode = d.ReasonCode left outer join sfc_operation  with (nolock)  on sfc_operation.OperationId = pd.OperationId left outer join Vendor  with (nolock)  on Vendor.cVenCode = pd.SVendorCode left outer join ComputationUnit   as pu with (nolock) on sd.AuxUnitCode = pu.cComunitCode left outer join AA_RequirementClass   as dc with (nolock)  on d.DemandCode = dc.cRClassCode left outer join Person with (nolock) on Person.cPersonCode = sd.EmployCode left outer join sfc_workshift with (nolock) on sfc_workshift.WorkShiftId = sd.ShiftId left outer join EQ_EQData as ec with (nolock) on ec.AutoID = sd.EQID  left outer join Team as td with (nolock) on td.cCode = sd.DutyClassCode  left outer join Reason as qr with (nolock) on sd.QualifiedReasonCode = qr.cReasonCode left outer join Reason as sr with (nolock) on sd.ScrapReasonCode = sr.cReasonCode left outer join Reason as rr with (nolock) on sd.RefusedReasonCode = rr.cReasonCode  where s.DocDate >=dateadd(dd,-45,getdate())   Order By s.DocCode,p.DocCode,o.MoCode,d.SortSeq,pd.OpSeq,sfc_workshift.Code,ec.cEQCode,sd.DutyClassCode,sd.EmployCode 