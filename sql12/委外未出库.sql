--select distinct top 100 percent MoDetailsID FROM  om_mohead inner join om_mobody on om_mohead.moid=om_mobody.moid   INNER JOIN (SELECT DISTINCT MoDetailsID as did  from om_momaterialsbody  WHERE 1=1 and isnull(iwiptype,3)=3 and isnull(bComsumeOM,0) =1  AND (isnull(iquantity,0)-isnull(isendqty,0)+isnull(iComplementQty,0)) >0 and isnull(csendtype,'0') ='0' and isnull(om_momaterialsbody.iProductType,0)=0 ) om_momaterialsbody ON om_mobody.modetailsid =  om_momaterialsbody.did left join (select cbdefine32 as cbdefine32,cbdefine33 as cbdefine33,momaterialsid as keyextend_b_momaterialsid_om_momaterials_extradefine_momaterialsid from om_momaterials_extradefine) extend_b_momaterialsid_om_momaterials_extradefine on keyextend_b_momaterialsid_om_momaterials_extradefine_momaterialsid=om_momaterialsbody.did  where  (case when isnull(cchanger,N'') <> N'' then isnull(cchangeverifier ,N'') else isnull(cverifier,N'') end) <> N'' and isnull(cbcloser,N'')=N'' AND  (1>0) AND (1>0)  AND ( 1=1   AND ((CVENABBNAME >= N'昌茂(张德强)') AND (CVENABBNAME <= N'昌茂(张德强)'))) 
--select '' as selcol,irowno,csocode,sotype,ccode,ddate,cdepcode,cdepname,cvencode,cvenabbname,cpersoncode,cpersonname,cmaker,cverifier,cinvcode,cinvaddcode,cinvname,cinvstd,cinvdefine1,cinvdefine2,cinvdefine3,cinvdefine4,cinvdefine5,cinvdefine6,cinvdefine7,cinvdefine8,cinvdefine9,cinvdefine10,cinvdefine11,cinvdefine12,cinvdefine13,cinvdefine14,cinvdefine15,cinvdefine16,ccomunitcode,cinvm_unit,cunitid,cinva_unit,citem_class,citem_name,citemcode,citemname,dstartdate,darrivedate,cfree1,cfree2,cfree3,cfree4,cfree5,cfree6,cfree7,cfree8,cfree9,cfree10,iquantity,inum,(case when isnull(iarrqty,0)<> 0 then isnull(iarrqty,0) else isnull(ireceivedqty,0) end ) as ireceivedqty,((isnull(iquantity,0)- (case when isnull(iarrqty,0)<> 0 then isnull(iarrqty,0) else isnull(ireceivedqty,0) end))) as iqty,modetailsid,ufts,cmemo,iOrderType,isourcemocode,isourcemodetailsid,cplanlotnumber FROM  om_mohead inner join om_mobody on om_mohead.moid=om_mobody.moid   INNER JOIN (SELECT DISTINCT MoDetailsID as did  from om_momaterialsbody  WHERE 1=1 and isnull(iwiptype,3)=3 and isnull(bComsumeOM,0) =1  AND (isnull(iquantity,0)-isnull(isendqty,0)+isnull(iComplementQty,0)) >0 and isnull(csendtype,'0') ='0' and isnull(om_momaterialsbody.iProductType,0)=0 ) om_momaterialsbody ON om_mobody.modetailsid =  om_momaterialsbody.did left join (select cbdefine32 as cbdefine32,cbdefine33 as cbdefine33,momaterialsid as keyextend_b_momaterialsid_om_momaterials_extradefine_momaterialsid from om_momaterials_extradefine) extend_b_momaterialsid_om_momaterials_extradefine on keyextend_b_momaterialsid_om_momaterials_extradefine_momaterialsid=om_momaterialsbody.did  where  (case when isnull(cchanger,N'') <> N'' then isnull(cchangeverifier ,N'') else isnull(cverifier,N'') end) <> N'' and isnull(cbcloser,N'')=N'' AND  (1>0) AND (1>0)  AND ( 1=1   AND ((CVENABBNAME >= N'昌茂(张德强)') AND (CVENABBNAME <= N'昌茂(张德强)'))) and MoDetailsID in ('1000149537','1000149538','1000149539','1000149545','1000149546','1000149549','1000149550','1000149553','1000149556','1000149557','1000149559','1000149562','1000149566','1000149570','1000149573','1000149576','1000149580','1000149581','1000149583','1000149584','1000149589','1000149590','1000150349','1000150905','1000151038','1000151097','1000151416','1000151562','1000151922','1000151924','1000151935','1000151936','1000152533','1000152534','1000152535','1000152560','1000152561','1000153239','1000153241','1000153242','1000153668','1000153669','1000153670','1000153671','1000153672','1000153678','1000153679','1000153680','1000153681','1000153686','1000153687','1000153688','1000153689','1000153690','1000153691','1000153692','1000153693','1000153694','1000153695','1000153696','1000153697','1000153698','1000153699','1000153708','1000153709','1000153710','1000154012','1000154013','1000154014','1000154100','1000154122','1000154123','1000154124') 
--SET TRANSACTION ISOLATION LEVEL READ COMMITTED
create view v_zy_wwwck as
select c.cCode,b.iVouchRowNo, a.cinvcode,cinvaddcode,cinvname,cinvstd,drequireddate,iunitquantity,a.iquantity,
 isendqty, iQty from
(select cinvcode,cinvaddcode,cinvname,cinvstd,drequireddate,iunitquantity,iquantity,
((isnull(isendqty,0)-isnull(iComplementQty,0))) as isendqty,((isnull(iquantity,0)-isnull(isendqty,0)+isnull(iComplementQty,0))) as iQty,MoDetailsID,MOMaterialsID 
FROM  om_momaterialsbody inner join om_mohead on om_momaterialsbody.moid=om_mohead.moid  
where isnull(iwiptype,3)=3 and isnull(bComsumeOM,0) =1  and (isnull(iquantity,0)-isnull(isendqty,0)+isnull(iComplementQty,0))>0  and ISNULL(csendtype,'0')='0'  and isnull(om_momaterialsbody.iProductType,0)=0 AND 1=1 and
 MoDetailsID in (select distinct top 100 percent MoDetailsID FROM  om_mohead inner join om_mobody on om_mohead.moid=om_mobody.moid   INNER JOIN (SELECT DISTINCT MoDetailsID as did  from om_momaterialsbody  WHERE 1=1 and isnull(iwiptype,3)=3 and isnull(bComsumeOM,0) =1  AND (isnull(iquantity,0)-isnull(isendqty,0)+isnull(iComplementQty,0)) >0 and isnull(csendtype,'0') ='0' and isnull(om_momaterialsbody.iProductType,0)=0 ) om_momaterialsbody ON om_mobody.modetailsid =  om_momaterialsbody.did left join (select cbdefine32 as cbdefine32,cbdefine33 as cbdefine33,momaterialsid as keyextend_b_momaterialsid_om_momaterials_extradefine_momaterialsid from om_momaterials_extradefine) extend_b_momaterialsid_om_momaterials_extradefine on keyextend_b_momaterialsid_om_momaterials_extradefine_momaterialsid=om_momaterialsbody.did  where  (case when isnull(cchanger,N'') <> N'' then isnull(cchangeverifier ,N'') else isnull(cverifier,N'') end) <> N'' and isnull(cbcloser,N'')=N'' AND  (1>0) AND (1>0)  AND ( 1=1   ) )) as a
left join OM_MODetails b on a.modetailsid=b.MODetailsID
left join OM_MOMain c on b.MOID=c.MOID